<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>JS Bin</title>
</head>

<body>
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <script>
        var data = [10, 10, 20,33, 40, 10, 5, 12, 5];

        var screen = {
            width: 500,
            height: 500,
            padding: 40,
            innterPadding: 20 //條圖內容與刻度間的距離，純粹讓顯示更好看
        };

        var barWidth = screen.width / data.length;

        var max = d3.max(data),
            min = d3.min(data);

        var yLiner = d3.scaleLinear()
            .domain([min > 0 ? 0 : min, max])
            .range([0, screen.height]);
        var _yLiner = d3.scaleLinear()
            .domain([min > 0 ? 0 : min, max])
            .range([screen.height, 0]);
        var xLiner = d3.scaleBand()
            .domain(data.map((d, i) => 'No.' + i))
            .range([0, screen.width]);

        var yAxis = d3.axisLeft(yLiner);
        var xAxis = d3.axisBottom(xLiner);

        var svg = d3.select('body')
            .append('svg')
            .attr('width', (data.length) * barWidth + screen.padding * 2)
            .attr('height', yLiner(max) + screen.padding * 2);

        svg.selectAll('rect').data(data).enter()
            .append('rect')
            .attr('x', (d, i) => i * barWidth + screen.padding + screen.innterPadding)
            .attr('y', (d) => {
                if (d > 0) {
                    return yLiner(max) - yLiner(d) + screen.padding;
                } else {
                    return yLiner(max) - yLiner(0) + screen.padding; //注意反轉邏輯
                };
            })
            .attr('width', d => barWidth - 3)
            .attr('height', d => {
                return Math.abs(yLiner(d) - yLiner(0))
            })
            .style('fill', d => d < 0 ? 'red' : '#CCC');

        svg.selectAll('text').data(data).enter().append('text')
            .text(a => a)
            .attr('x', (d, i) => i * barWidth + screen.padding + screen.innterPadding)
            .attr('y', d => screen.height - yLiner(d) + screen.padding)
            .attr("dy", "1em")
            .attr("dx", xLiner.bandwidth() / 2)
            .attr("text-anchor", "middle");

        svg.append('g').attr("transform", "translate(" + screen.padding + "," + screen.padding + ")")
            .call(d3.axisLeft(_yLiner));

        svg.append('g').attr("transform", "translate(" + (screen.padding + screen.innterPadding) + "," + (screen.height + screen.padding + screen.innterPadding) + ")")
            .call(xAxis);

    </script>
</body>

</html>